on: [push, pull_request]

name: MPI

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        include:
          - os: ubuntu-latest
            rust: stable
            mpi: libmpich-dev
          - os: macos-latest
            rust: stable
            mpi: open-mpi
          - os: windows-2022
            rust: stable
            
    name: ${{ matrix.os }} example
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup MPI
        uses: mpi4py/setup-mpi@v1
        with:
          mpi: ${{ matrix.mpi }}
      - run: mpicc helloworld.c -o helloworld
      - run: mpiexec -n 2 ./helloworld